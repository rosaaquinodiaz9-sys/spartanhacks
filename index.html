<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>estarlinhacks | V3 ULTRA</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap');
        :root { --neon: #00f2ff; --accent: #ff0055; --bg: #050508; }
        body { background: var(--bg); color: white; font-family: 'Rajdhani', sans-serif; margin: 0; }
        .header { display: flex; justify-content: space-between; padding: 15px 20px; background: #000; border-bottom: 2px solid var(--neon); }
        .logo { font-family: 'Orbitron'; color: var(--neon); text-shadow: 0 0 10px var(--neon); }
        
        /* Dashboard Estilo Pro */
        .dashboard { padding: 20px; background: radial-gradient(circle at top, rgba(0,242,255,0.1), transparent); }
        .stat-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 15px; border-left: 4px solid var(--neon); margin-bottom: 15px; }
        .val { font-family: 'Orbitron'; font-size: 1.5rem; color: var(--neon); }

        /* Panel Admin Oculto */
        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .pago-item { background: #111; padding: 15px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #333; }
        .btn-aprobar { background: #00ff64; color: black; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        .buy-btn { width: 100%; padding: 12px; background: linear-gradient(45deg, var(--neon), #0066ff); border: none; color: white; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">ESTARLINHACKS</div>
        <div id="user-info" style="font-size: 0.8rem;">Cargando...</div>
    </div>

    <!-- PANEL DE SALDO -->
    <div class="dashboard">
        <div class="stat-card">
            <small>CRÉDITOS DISPONIBLES</small>
            <div id="user-balance" class="val">$0.00</div>
        </div>
        <button class="buy-btn" onclick="mostrarPagos()">RECARGAR SALDO</button>
    </div>

    <!-- SECCIÓN DE PRODUCTOS -->
    <div style="padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="stat-card" style="border-left-color: var(--accent);">
            <h4>HOLOGRAMA</h4>
            <div style="color: #00ff64;">$5.00</div>
            <button class="buy-btn" style="margin-top:10px" onclick="comprar('Holograma', 5)">COMPRAR</button>
        </div>
        <div class="stat-card" style="border-left-color: var(--accent);">
            <h4>AIMBOT 100%</h4>
            <div style="color: #00ff64;">$15.00</div>
            <button class="buy-btn" style="margin-top:10px" onclick="comprar('Aimbot', 15)">COMPRAR</button>
        </div>
    </div>

    <!-- PANEL ADMINISTRADOR (BOTÓN OCULTO) -->
    <button onclick="loginAdmin()" style="opacity: 0.1; background: none; border: none; color: white; position: fixed; bottom: 0;">.</button>

    <div id="admin-panel">
        <h2 style="color: var(--neon);">PANEL DE APROBACIÓN - ESTARLIN</h2>
        <div id="lista-pendientes"></div>
        <button onclick="document.getElementById('admin-panel').style.display='none'" style="background: red; color: white; width: 100%; padding: 15px; border: none; margin-top: 20px;">CERRAR PANEL</button>
    </div>

    <script>
        // CONFIGURACIÓN DE TU FIREBASE
        const firebaseConfig = {
          apiKey: "AIzaSyCyfGnvZCaJbZQ54W31z6GQdIRQZc4Lk5A",
          authDomain: "estarlinhacks-af6cd.firebaseapp.com",
          projectId: "estarlinhacks-af6cd",
          storageBucket: "estarlinhacks-af6cd.firebasestorage.app",
          messagingSenderId: "815848600809",
          appId: "1:815848600809:web:92ec6140947813f3456c78"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // SIMULACIÓN DE USUARIO (En el futuro agregaremos el login real)
        let currentUser = "Estarlin_User"; 

        // Leer saldo automáticamente
        function cargarSaldo() {
            db.collection("usuarios").doc(currentUser).onSnapshot((doc) => {
                if (doc.exists) {
                    document.getElementById('user-balance').innerText = "$" + doc.data().saldo.toFixed(2);
                    document.getElementById('user-info').innerText = "HOLA, " + currentUser;
                } else {
                    // Crear usuario si no existe
                    db.collection("usuarios").doc(currentUser).set({ saldo: 0.00 });
                }
            });
        }
        cargarSaldo();

        // Función para comprar
        function comprar(item, precio) {
            db.collection("usuarios").doc(currentUser).get().then((doc) => {
                let saldoActual = doc.data().saldo;
                if(saldoActual >= precio) {
                    db.collection("usuarios").doc(currentUser).update({ saldo: saldoActual - precio });
                    alert("¡Compra exitosa de " + item + "!");
                } else {
                    alert("Saldo insuficiente. Por favor recarga.");
                }
            });
        }

        // Reportar Pago (Lo que hace el cliente)
        function mostrarPagos() {
            let ref = prompt("Ingresa el ID de Transacción de tu pago (PayPal/Banco):");
            if(ref) {
                db.collection("pagos_pendientes").add({
                    usuario: currentUser,
                    referencia: ref,
                    fecha: new Date().toLocaleString(),
                    monto: 10.00 // Puedes hacerlo variable
                });
                alert("Reporte enviado. Estarlin verificará tu pago en unos minutos.");
            }
        }

        // PANEL DE ADMINISTRADOR
        function loginAdmin() {
            let pass = prompt("Contraseña de Administrador:");
            if(pass === "admin_estarlin") {
                document.getElementById('admin-panel').style.display = 'block';
                cargarPagosPendientes();
            }
        }

        function cargarPagosPendientes() {
            db.collection("pagos_pendientes").onSnapshot((snapshot) => {
                let html = "";
                snapshot.forEach((doc) => {
                    let data = doc.data();
                    html += `
                        <div class="pago-item">
                            <b>Usuario:</b> ${data.usuario}<br>
                            <b>Ref:</b> ${data.referencia}<br>
                            <b>Fecha:</b> ${data.fecha}<br><br>
                            <button class="btn-aprobar" onclick="aprobarPago('${doc.id}', '${data.usuario}', 10)">APROBAR $10.00</button>
                        </div>
                    `;
                });
                document.getElementById('lista-pendientes').innerHTML = html || "No hay pagos pendientes";
            });
        }

        function aprobarPago(idDoc, usuario, monto) {
            // 1. Sumar saldo al usuario
            const userRef = db.collection("usuarios").doc(usuario);
            db.runTransaction((transaction) => {
                return transaction.get(userRef).then((userDoc) => {
                    let nuevoSaldo = (userDoc.data().saldo || 0) + monto;
                    transaction.update(userRef, { saldo: nuevoSaldo });
                });
            }).then(() => {
                // 2. Borrar el reporte pendiente
                db.collection("pagos_pendientes").doc(idDoc).delete();
                alert("¡Pago aprobado y saldo enviado!");
            });
        }
    </script>
</body>
</html>
